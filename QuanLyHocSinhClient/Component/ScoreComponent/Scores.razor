@page "/score"

<MudTable Class="mt-3 diem_table" Items="@subjects" Hover="true" Bordered="true" Breakpoint="Breakpoint.Sm" LoadingProgressColor="Color.Info">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Học kì 1 - Năm 2021-2022</MudText>
        <MudSpacer />
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Subject</MudTh>
        @foreach (var item in testTypes)
        {
            <MudTd>@item.TestName</MudTd>
        }
        <MudTh>Trung bình</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="SemesterId">@context.Name</MudTd>
        @for (int i = 0; i < testTypes.Count; i++)
        {
            int testTypeId = testTypes[i].Id;
            string dataLabel = testTypes[i].TestName;
            <MudTd DataLabel="@dataLabel">@scores.FirstOrDefault(x => x.SubjectId == context.Id && x.TestTypeId == testTypeId)?.Point</MudTd>

        }
        


    </RowTemplate>
</MudTable>

@code {
    int semesterId = 1;
    Guid studentId = new Guid("e37ea4e6-a000-4fb5-dbac-08d9ae862a65");
    List<Score> scores = new List<Score>();
    List<TestType> testTypes = new List<TestType>();
    List<Subject> subjects = new List<Subject>();
    protected async override Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        testTypes = await API<List<TestType>>.Instance.GetAsync("api/testtypes");
        subjects = await API<List<Subject>>.Instance.GetAsync("api/subjects");
        scores = await API<List<Score>>.Instance.GetAsync($"/api/Scores/ScoresByStudentAndSemester/{studentId}/{semesterId}");
    }
    double AverageScore(int i, int j)
    {
        double avrg=0;
        foreach(var item in scores)
        { 
            if(item.TestTypeId== testTypes[i].Id && subjects[i].Id==item.SubjectId)
            avrg += item.Point *item.TestTypeNavigation.ScoreFactor;
        }
        return avrg;
    }
}